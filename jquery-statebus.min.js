!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(l){var c=l.extend,u=l.isPlainObject,p=l({}),s={state:{},action:{},helper:{},prevState:{}};function f(t){return JSON.parse(JSON.stringify(t))}function h(t){return Array.prototype.slice.call(t)}function n(r,e,t,a,n){n&&a(r.state,null,{helper:r.helper}),e&&(t=l.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t}));var o=function(t,e,n){a(r.state,r.prevState,{actionName:e,args:n,helper:r.helper})};return p.on(t=t.join?t.join(" "):t,o),function(){p.off(t,o)}}l.statebus=c(function(o,t,e){var i={state:{},action:{},helper:{},prevState:null};e?p.off(o):(c(i.state,s.state[o]),c(i.action,s.action[o]),c(i.helper,s.helper[o]));u(t.state)&&c(i.state,f(t.state));return l.each(t.helper||{},function(t,e){i.helper[t]=function(){return e.apply(i.state,[i].concat(h(arguments)))}}),l.each(t.action||{},function(r,a){i.action[r]=function(){var t=h(arguments),e=i.state,n=a.apply(i.state,[i].concat(t));return u(n)&&(s.state[o]=i.state=c({},i.state,f(n)),s.prevState[o]=i.prevState=e),p.trigger(o+"."+r,[r,t]),p.trigger(o+".all",[r,t]),n}}),s.state[o]=i.state,s.action[o]=i.action,s.helper[o]=i.helper,c(i,{on:l.proxy(n,null,i,o)})},s,{on:l.proxy(n,null,s,null)})});