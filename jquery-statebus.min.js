!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(u){var c=u.extend,f=u({}),l={state:{},action:{},prevState:{}};function n(a,e,t,i,n){n&&i(a,{immediately:!0}),e&&(t=u.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t}));var o=function(t,e,n){i(a,{actionName:e,args:n,immediately:!1})};return f.on(t=t.join?t.join(" "):t,o),function(){f.off(t,o)}}u.statebus=c(function(o,t,e){var r=c({},t);u.each(r.action,function(a,i){r.action[a]=function(){var t=u.makeArray(arguments),e=r.state,n=i.apply(r,t);return u.isPlainObject(n)&&(l.state[o]=r.state=c({},r.state,n),l.prevState[o]=r.prevState=e),f.trigger(o+"."+a,[a,t]),f.trigger(o+".all",[a,t]),n}}),e?f.off(o):(l.prevState[o]=null,c(r.state,l.state[o]),c(r.action,l.action[o]));return l.state[o]=r.state,l.action[o]=r.action,c(r,{on:u.proxy(n,null,r,o)})},l,{on:u.proxy(n,null,l,null),remove:function(t){delete l.state[t],delete l.action[t],delete l.prevState[t],f.off(t)}})});