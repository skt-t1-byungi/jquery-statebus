!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(l){var u=l.extend,c=l.isPlainObject,p=l({}),s={state:{},action:{},helper:{},prevState:{}};function f(t){return JSON.parse(JSON.stringify(t))}function n(a,e,t,r,n){n&&r(a.state,null,{helper:a.helper}),e&&(t=l.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t}));var o=function(t,e,n){r(a.state,a.prevState,{actionName:e,args:n,helper:a.helper})};return p.on(t=t.join?t.join(" "):t,o),function(){p.off(t,o)}}l.statebus=u(function(o,t,e){var i={state:{},action:{},helper:{},prevState:null};e?p.off(o):(u(i.state,s.state[o]),u(i.action,s.action[o]),u(i.helper,s.helper[o]));c(t.state)&&u(i.state,f(t.state));return l.each(t.helper||{},function(t,e){i.helper[t]=function(){return e.apply(i.state,[i].concat(l.makeArray(arguments)))}}),l.each(t.action||{},function(a,r){i.action[a]=function(){var t=l.makeArray(arguments),e=i.state,n=r.apply(i.state,[i].concat(t));return c(n)&&(s.state[o]=i.state=u({},i.state,f(n)),s.prevState[o]=i.prevState=e),p.trigger(o+"."+a,[a,t]),p.trigger(o+".all",[a,t]),n}}),s.state[o]=i.state,s.action[o]=i.action,s.helper[o]=i.helper,u(i,{on:l.proxy(n,null,i,o)})},s,{on:l.proxy(n,null,s,null)})});