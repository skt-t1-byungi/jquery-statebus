!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(u){var c=u.extend,s=u({}),f={state:{},action:{},prevState:{}};function l(t){return JSON.parse(JSON.stringify(t))}function n(a,e,t,i,n){n&&i(a,{immediately:!0}),e&&(t=u.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t}));var o=function(t,e,n){i(a,{actionName:e,args:n,immediately:!1})};return s.on(t=t.join?t.join(" "):t,o),function(){s.off(t,o)}}u.statebus=c(function(o,t,e){var r=c({state:{},action:{},prevState:null},t);r.state=l(r.state),u.each(r.action,function(a,i){r.action[a]=function(){var t=u.makeArray(arguments),e=r.state,n=i.apply(r,t);return u.isPlainObject(n)&&(f.state[o]=r.state=c({},r.state,l(n)),f.prevState[o]=r.prevState=e),s.trigger(o+"."+a,[a,t]),s.trigger(o+".all",[a,t]),n}}),e?s.off(o):(c(r.state,f.state[o]),c(r.action,f.action[o]));return f.state[o]=r.state,f.action[o]=r.action,c(r,{on:u.proxy(n,null,r,o)})},f,{on:u.proxy(n,null,f,null)})});