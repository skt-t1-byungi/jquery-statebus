!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(u){var c=u.extend,s=u.isPlainObject,f=u({}),l={state:{},action:{},prevState:{}};function p(t){return JSON.parse(JSON.stringify(t))}function n(a,e,t,i,n){n&&i(a,{immediately:!0}),e&&(t=u.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t}));var o=function(t,e,n){i(a,{actionName:e,args:n,immediately:!1})};return f.on(t=t.join?t.join(" "):t,o),function(){f.off(t,o)}}u.statebus=c(function(o,t,e){var r=c({state:{},action:{},prevState:null},t);r.state=p(r.state),u.each(r.action,function(a,i){r.action[a]=function(){var t=u.makeArray(arguments),e=r.state,n=i.apply(r,t);return s(n)&&(l.state[o]=r.state=c({},r.state,p(n)),l.prevState[o]=r.prevState=e),f.trigger(o+"."+a,[a,t]),f.trigger(o+".all",[a,t]),n}}),e?f.off(o):(c(r.state,l.state[o]),c(r.action,l.action[o]));return l.state[o]=r.state,l.action[o]=r.action,c(r,{on:u.proxy(n,null,r,o)})},l,{on:u.proxy(n,null,l,null)})});