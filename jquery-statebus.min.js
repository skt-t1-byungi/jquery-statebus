!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(s){var u=s.extend,c=s.isPlainObject,l=s({}),f={state:{},action:{},prevState:{}};function p(t){return JSON.parse(JSON.stringify(t))}function n(n,e,t,a,i){i&&a(n.state,null,[]),e&&(t=s.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t})),l.on(t.join?t.join(" "):t,function(t,e){a(n.state,n.prevState,e)})}s.statebus=u(function(o,t,e){var r={state:{},action:{},prevState:null};e?l.off(o):(u(r.state,f.state[o]),u(r.action,f.action[o]));c(t.state)&&u(r.state,p(t.state));return s.each(t.action||{},function(a,i){r.action[a]=function(){var t=[].slice.call(arguments),e=r.state,n=i.apply({state:r.state,action:r.action},t);return c(n)&&(f.state[o]=r.state=u({},r.state,p(n)),f.prevState[o]=r.prevState=e),l.trigger(o+"."+a,[t]),n}}),f.state[o]=r.state,f.action[o]=r.action,u(r,{on:s.proxy(n,null,r,o)})},f,{on:s.proxy(n,null,f,null)})});