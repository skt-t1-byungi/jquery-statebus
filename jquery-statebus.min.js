!function(t,e){"object"==typeof module&&module.exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery||t.$)}(window||this,function(s){var c=s.extend,u=s({}),f={state:{},action:{},prevState:{}};function l(t){return t&&"object"==typeof t?JSON.parse(JSON.stringify(t)):{}}function n(n,e,t,a,o){o&&a(n.state,null,[]),e&&(t=s.map(t.split?t.split(/\s+/):t,function(t){return e+"."+t})),u.on(t.join?t.join(" "):t,function(t,e){a(n.state,n.prevState,e)})}s.statebus=c(function(i,t,e){var r={state:{},action:{},prevState:null};e?u.off(i):(c(r.state,f.state[i]),c(r.action,f.action[i]));return c(r.state,l(t.state)),s.each(t.action||{},function(a,o){r.action[a]=function(){var t=[].slice.call(arguments),e=r.state,n=l(o.apply({state:r.state,action:r.action},t));f.state[i]=r.state=c({},r.state,n),f.prevState[i]=r.prevState=e,u.trigger(i+"."+a,[t])}}),f.state[i]=r.state,f.action[i]=r.action,c(r,{on:s.proxy(n,null,r,i)})},f,{on:s.proxy(n,null,f,null)})});